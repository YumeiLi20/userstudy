<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pre Study Survey</title>
    <!--<link href="../css/survey.css" rel="stylesheet">-->
</head>
<body>
<div id="demographics">
    <div  style="left: 0px; width: 750px;"  >
    <h3 style="text-align: center">Pre-Study Survey</h3>

    <p id="demoinstr" style="text-align: center">
        Please fill out the short survey. The study will begin after you do. No personal information is being collected.
    </p>
    </div>

    <form>
    <br>
    <div id="sex" style="position: absolute; left: 0px; width: 340px;  text-align: right; top: 100px;">1. Gender: </div>
        <div id="sexes" style="position: absolute; left: 350px; top: 100px">
            <input type="radio" id="s1" name="sex" value="Male"> Male
            <input type="radio" id="s2" name="sex" value="Female"> Female
            <input type="radio" id="s3" name="sex" value="Prefer not to disclose"> Prefer not to disclose
        </div>
    <br>

    <div id="age"style="position: absolute; left:0px; width: 340px;  text-align: right; top: 150px">2. Age:
    </div>
        <div id="ages" style="position: absolute; left: 350px; top: 150px">
        <input type="number" name="age" min="10" max="100">
        </div>
    <br>

    <div id="occupation" style="position: absolute; left:0px; width: 340px;  text-align: right; top: 200px">3. Occupation:
    </div>
        <div id="occupations" style="position: absolute; left: 350px; top: 200px">
        <input type="radio" id="o1" name="occupation" value="Student"> Student
        <input type="radio" id="o2" name="occupation" value="Research Staff"> Research Staff
        <input type="radio" id="o3" name="occupation" value="Faculty"> Faculty
        <input type="radio" id="o4" name="occupation" value="Other"> Other
        <input type="text" id="o5" name="occupation">
        </div>
    <br>

        <!--style="position: absolute; left:0px; width: 1000px; top: 250px"-->
    <div id="div_student" >
        <div id="current_degree" style="position: absolute; left:0px; width: 340px;  text-align: right;  top: 250px">4. Current Degree (If student):
        </div>
        <div id="degrees" style="position: absolute; left: 350px; top: 250px">
            <input type="radio" id="d1" name="current_degree" value="High School"> High School
            <input type="radio" id="d2" name="current_degree" value="Bachelors"> Bachelors
            <input type="radio" id="d3" name="current_degree" value="Masters"> Masters
            <input type="radio" id="d4" name="current_degree" value="PhD"> PhD
            <input type="radio" id="d5" name="current_degree" value="Other"> Other
            <input type="text" id="d6" name="current_degree" >
        </div>
        <!--<br>-->

        <div id="department"  style="position: absolute; left: 0px;width: 340px;  text-align: right; top: 300px">5. Department (If student):
        </div>


    </div>
    <br>

    <div id="div_highest_degree" style="position: absolute; left: 0px;width: 340px;  text-align: right;  top: 350px">6. Highest Degree obtained:
    </div>
        <div id="degrees_2" style="position: absolute; left: 350px; top: 350px">
        <input type="radio" id="h1" name="highest_degree" value="High School"> High School
        <input type="radio" id="h2" name="highest_degree" value="Bachelors"> Bachelors
        <input type="radio" id="h3" name="highest_degree" value="Masters"> Masters
        <input type="radio" id="h4" name="highest_degree" value="PhD"> PhD
        <input type="radio" id="h5" name="highest_degree" value="Other"> Other
        <input type="text" id="h6" name="highest_degree" style="visibility: hidden">
        </div>
    <br>

    <div id="div_us_age" style="position: absolute; left: 0px;width: 340px;  text-align: right;  top: 400px">7. Length of stay in the US:
    </div>
        <div style="position: absolute; left: 350px; top: 400px">
        <input type="number" name="us_age" id="us_years" min="0" max="100"> Years
        <input type="number" name="us_age" id="us_months" min="0" max="12"> Months
        </div>
    <br>

    <div id="div_country"  style="position: absolute; left: 0px;width: 340px;  text-align: right;  top: 450px">
        8. Country you lived the majority of your life:
    </div>
    <div id="country_choices"></div>
    <br>

    <div id="div_english" style="position: absolute; left: 0px;width: 340px;  text-align: right;  top: 500px">
        9. Is English your first language?
    </div>
    <div style="position: absolute; left: 350px; top: 500px">
        <input type="radio" id="e1" name="english" value="Yes"> Yes
        <input type="radio" id="e2" name="english" value="No"> No
    </div>
    <br>

    <div id="div_color" style="position: absolute; left: 0px;width: 340px;  text-align: right;  top: 550px">
        10. Do you have any known color blindness?
    </div>
    <div style="position: absolute; left: 350px; top: 550px">
        <input type="radio" id="c1" name="color" value="Yes"> Yes
        <input type="radio" id="c2" name="color" value="No"> No
    </div>
    <br>


    <div id="div_data" style="position: absolute; left: 0px;width: 340px;  text-align: right;  top: 600px">
        11. Rate your experience working with data or doing data analysis, including numerical inspection or descriptive statistics on a scale of 1 to 10:
    </div>
    <div style="position: absolute; left: 350px; top: 600px">
        <input id="data_ana" name="data_analysis" type="range" min="1" max="10" step="1"  size="5"> <label id="lbl_data_ana" style="display: inline-block"></label><br>
    </div>
    <div  style="position: absolute; left: 0px;width: 340px;  text-align: right;  top: 685px">
        Briefly explain:
    </div>
        <textarea name="data_ana_text" rows="4" cols="50" style="position: absolute; left: 350px;  top: 665px">

        </textarea>
    <br>


    <div id="div_submit">
        <input type="button" id="submitComments" name="button_submit" value="Submit" style="position: absolute; left: 325px;  top: 780px">
    </div>

    </form>

</div>


<script>
    console.log("Hi! You are now taking the pre-survey!");

    (function() {
        var pre_survey_data = {};
        experimentr.startTimer('pre_survey_timer');
        experimentr.hideNext();


//        d3.select("#div_student").style("display","none");
        d3.select("#o5").style("visibility","hidden");
        d3.select("#d6").style("visibility","hidden");

//      get values
        d3.selectAll('input')
            .filter(function(d) { return this.name === 'sex' ? this : null; })
            .on('change', function() { data.sex = this.value;})

        d3.selectAll('input')
            .filter(function(d) { return this.name === 'age' ? this : null; })
            .on('change', function() { data.age = this.value;})

        for(i=1;i<7;i++) {
            d3.select('#d'+i).attr("disabled","true");
        }


//      If student
        d3.selectAll('input')
            .filter(function(d) { return this.name === 'occupation' ? this : null; })
            .on('change', function() {
                for(i=1;i<7;i++) {
                    d3.select('#d'+i).attr("disabled","true");
                }
                d3.select("#dept").attr("disabled","true");
                if(d3.select("#o4").property("checked")) {
                    d3.select("#o5")
                        .style("visibility","visible");
//                    d3.select("#div_student")
//                        .style("display","none");
                    d3.select("#d6")
                        .style("visibility","hidden");
                } else {
                    d3.select("#o5")
                        .style("visibility","hidden");
                    if(d3.select("#o1").property("checked")) {
                        d3.select("#dept").attr("disabled",null);
                        for(i=1;i<7;i++) {
                            console.log(i);
                            d3.select('#d'+i).attr("disabled",null);
                        }
                    } else {
//                        d3.select("#div_student")
//                            .style("display","none");
                    }
                }
                data.occupation = this.value;
                console.log(data.occupation);
            })

        d3.selectAll('input')
            .filter(function(d) { return this.name === 'current_degree' ? this : null; })
            .on('change', function() {
                if(d3.select("#d5").property("checked")) {
                    d3.select("#d6")
                        .style("visibility","visible");
                } else {
                    d3.select("#d6")
                        .style("visibility","hidden");
                }
                data.current_degree = this.value;
            })

        d3.selectAll('input')
            .filter(function(d) { return this.name === 'highest_degree' ? this : null; })
            .on('change', function() {
                if(d3.select("#h5").property("checked")) {
                    d3.select("#h6")
                        .style("visibility","visible");
                } else {
                    d3.select("#h6")
                        .style("visibility","hidden");
                }
                data.highest_degree = this.value;
            })


        d3.csv("../resources/other_data/dept_list.csv", function(error, dt) {
            var select = d3.select("#div_student")
                .append("select")
                .attr("name","dpt")
                .attr("id","dept")
                .attr("disabled","true")
                .style("position","absolute")
                .style("left", "350px")
                .style("top", "300px");

            select
                .on("change", function(d) {
                    data.department = d3.select(this).property("value");
                    console.log(data.department);
                });

            select.selectAll("option")
                .data(dt)
                .enter()
                .append("option")
                .attr("value", function (d) { return d.four_code; })
                .text(function (d) { return d.four_code; });
        });

        d3.csv("../resources/other_data/countries.csv", function(error, dt) {
            var select = d3.select("#country_choices")
                .append("select")
                .attr("name","country")
                .style("position","absolute")
                .style("left", "350px")
                .style("top", "450px");

            select
                .on("change", function(d) {
                    data.country = d3.select(this).property("value");
                    console.log(data.country);
                });

            select.selectAll("option")
                .data(dt)
                .enter()
                .append("option")
                .attr("value", function (d) { return d.countries; })
                .text(function (d) { return d.countries; });
        });

        d3.selectAll('input')
            .filter(function(d) { return this.name === 'us_years' ? this : null; })
            .on('change', function() { data.us_years = this.value;})

        d3.selectAll('input')
            .filter(function(d) { return this.name === 'us_months' ? this : null; })
            .on('change', function() { data.us_months = this.value;})

        d3.selectAll('input')
            .filter(function(d) { return this.name === 'english' ? this : null; })
            .on('change', function() { data.english = this.value;})

        d3.selectAll('input')
            .filter(function(d) { return this.name === 'country' ? this : null; })
            .on('change', function() { data.country = this.value;})

        d3.selectAll('textarea')
            .filter(function(d) { return this.name === 'data_ana_text' ? this : null; })
            .on('change', function() { data.data_experience_explanation = this.value;})


        d3.select("#data_ana").style("width","100px");
        d3.selectAll('input')
            .filter(function(d) { return this.name === 'data_analysis' ? this : null; })
            .on('change', function() {
                console.log(this.value); data.data_analysis_skill = this.value;
                d3.select("#lbl_data_ana").text(function(){return data.data_analysis_skill;});
            })


        //{ return data.data_analysis_skill;})

//      submit
        function goToNext() {
            experimentr.addData(data);
            experimentr.next();
        };

        d3.select('#submitComments')
            .on('click', function () {
                experimentr.endTimer('pre_survey_timer');
                goToNext();
            });
    }());


</script>
</body>
</html>