for(i in 1:n_samples) {
(gids <-
starred_data %>%
group_by(type,`Record ID`) %>%
sample_n(1) %$%
`Group ID`)
(sample_i <-
starred_data %>% filter(`Group ID` %in% gids))
(gids_ordered <-
sample_i %>%
arrange(type) %>%
group_by(type) %>%
do(sample_n(.,size = nrow(.))) %$%
`Group ID` %>%
unique())
(lookup <- tibble(`Group ID` = gids_ordered) %>%
mutate(qnum = 1:n()))
sample_i <-
sample_i %>%
left_join(lookup, by = "Group ID") %>%
mutate(`Group ID` = qnum) %>%
select(-qnum) %>%
arrange(type,`Group ID`)
#make the names standard
names(sample_i) <- c("Group ID", "Record ID",
"First Name", "FF",
"Last Name", "LF",
"Reg No.", "DoB", "Race",
"First Name", "Last Name",
"Reg No.", "DoB", "Race",
"type","Answer")
sample_i %>%
write_csv(paste0(sprintf("./data_output/samples/sample_%02d",i),".csv"))
}
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n != 2) %>%
select(-n) %>%
ungroup()
library(dplyr)
library(readr)
library(magrittr)
library(stringr)
is_not_empty <- function(string) {
if(is.na(string) | string == "" | string == ".") {
return(FALSE)
} else {
return(TRUE)
}
}
is_not_empty = Vectorize(is_not_empty)
(source_data <- read_csv("data_input/all.csv",
col_types = cols(.default = "c")))
input_data <-
source_data %>%
mutate_each(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(last_name = str_c(last_name, name_sufx_cd, sep = " "),
file_id = str_c(src, file_id, sep = "-")) %>%
mutate_each(funs(str_trim(.))) %>%
select(ID, voter_reg_num, last_name, first_name, dob, race, type,
everything(), -name_sufx_cd,-src)
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n != 2) %>%
select(-n) %>%
ungroup()
is_not_empty <- function(string) {
if(is.na(string) | string == "" | string == ".") {
return(FALSE)
} else {
return(TRUE)
}
}
is_not_empty = Vectorize(is_not_empty)
(source_data <- read_csv("data_input/all.csv",
col_types = cols(.default = "c")))
input_data <-
source_data %>%
mutate_each(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(last_name = str_c(last_name, name_sufx_cd, sep = " "),
file_id = str_c(src, file_id, sep = "-")) %>%
mutate_each(funs(str_trim(.))) %>%
select(ID, voter_reg_num, last_name, first_name, dob, race, type,
everything(), -name_sufx_cd,-src)
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n != 2) %>%
select(-n) %>%
ungroup()
input_data <-
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n == 2) %>%
select(-n) %>%
ungroup()
write_csv(input_data, "./data_intermediate/all_no_stars.csv")
library(dplyr)
library(readr)
library(magrittr)
library(stringr)
library(forcats)
is_not_empty <- function(string) {
if(is.na(string) | string == "" | string == ".") {
return(FALSE)
} else {
return(TRUE)
}
}
is_not_empty = Vectorize(is_not_empty)
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c")) %>%
mutate_each(funs(ifelse(is_not_empty(.),.,""))))
(starred_data <-
starred_data %>%
mutate(`Record ID` = str_extract(`Record ID`,"[0-9]+")))
starred_data %>%
select(`Group ID`,type,`Record ID`) %>%
group_by(type,`Record ID`) %>%
unique() %>% count(type,`Record ID`)
set.seed(1)
for(i in 1:n_samples) {
(gids <-
starred_data %>%
group_by(type,`Record ID`) %>%
sample_n(1) %$%
`Group ID`)
(sample_i <-
starred_data %>% filter(`Group ID` %in% gids))
(gids_ordered <-
sample_i %>%
arrange(type) %>%
group_by(type) %>%
do(sample_n(.,size = nrow(.))) %$%
`Group ID` %>%
unique())
(lookup <- tibble(`Group ID` = gids_ordered) %>%
mutate(qnum = 1:n()))
sample_i <-
sample_i %>%
left_join(lookup, by = "Group ID") %>%
mutate(`Group ID` = qnum) %>%
select(-qnum) %>%
arrange(type,`Group ID`)
#make the names standard
names(sample_i) <- c("Group ID", "Record ID",
"First Name", "FF",
"Last Name", "LF",
"Reg No.", "DoB", "Race",
"First Name", "Last Name",
"Reg No.", "DoB", "Race",
"type","Answer")
sample_i %>%
write_csv(paste0(sprintf("./data_output/samples/sample_%02d",i),".csv"))
}
library(dplyr)
library(readr)
library(magrittr)
library(stringr)
is_not_empty <- function(string) {
if(is.na(string) | string == "" | string == ".") {
return(FALSE)
} else {
return(TRUE)
}
}
is_not_empty = Vectorize(is_not_empty)
(source_data <- read_csv("data_input/all.csv",
col_types = cols(.default = "c")))
input_data <-
source_data %>%
mutate_each(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(last_name = str_c(last_name, name_sufx_cd, sep = " ")) %>%
mutate_each(funs(str_trim(.))) %>%
select(ID, voter_reg_num, last_name, first_name, dob, race, type,
everything(), -name_sufx_cd,-src)
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n != 2) %>%
select(-n) %>%
ungroup()
input_data <-
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n == 2) %>%
select(-n) %>%
ungroup()
write_csv(input_data, "./data_intermediate/all_no_stars.csv")
library(dplyr)
library(readr)
library(magrittr)
library(stringr)
library(forcats)
is_not_empty <- function(string) {
if(is.na(string) | string == "" | string == ".") {
return(FALSE)
} else {
return(TRUE)
}
}
is_not_empty = Vectorize(is_not_empty)
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c")) %>%
mutate_each(funs(ifelse(is_not_empty(.),.,""))))
(starred_data <-
starred_data %>%
mutate(`Record ID` = str_extract(`Record ID`,"[0-9]+")))
starred_data %>%
select(`Group ID`,type,`Record ID`) %>%
group_by(type,`Record ID`) %>%
unique() %>% count(type,`Record ID`)
set.seed(1)
for(i in 1:n_samples) {
(gids <-
starred_data %>%
group_by(type,`Record ID`) %>%
sample_n(1) %$%
`Group ID`)
(sample_i <-
starred_data %>% filter(`Group ID` %in% gids))
(gids_ordered <-
sample_i %>%
arrange(type) %>%
group_by(type) %>%
do(sample_n(.,size = nrow(.))) %$%
`Group ID` %>%
unique())
(lookup <- tibble(`Group ID` = gids_ordered) %>%
mutate(qnum = 1:n()))
sample_i <-
sample_i %>%
left_join(lookup, by = "Group ID") %>%
mutate(`Group ID` = qnum) %>%
select(-qnum) %>%
arrange(type,`Group ID`)
#make the names standard
names(sample_i) <- c("Group ID", "Record ID",
"First Name", "FF",
"Last Name", "LF",
"Reg No.", "DoB", "Race",
"First Name", "Last Name",
"Reg No.", "DoB", "Race",
"type","Answer")
sample_i %>%
write_csv(paste0(sprintf("./data_output/samples/sample_%02d",i),".csv"))
}
for(i in 1:10) {
(gids <-
starred_data %>%
group_by(type,`Record ID`) %>%
sample_n(1) %$%
`Group ID`)
(sample_i <-
starred_data %>% filter(`Group ID` %in% gids))
(gids_ordered <-
sample_i %>%
arrange(type) %>%
group_by(type) %>%
do(sample_n(.,size = nrow(.))) %$%
`Group ID` %>%
unique())
(lookup <- tibble(`Group ID` = gids_ordered) %>%
mutate(qnum = 1:n()))
sample_i <-
sample_i %>%
left_join(lookup, by = "Group ID") %>%
mutate(`Group ID` = qnum) %>%
select(-qnum) %>%
arrange(type,`Group ID`)
#make the names standard
names(sample_i) <- c("Group ID", "Record ID",
"First Name", "FF",
"Last Name", "LF",
"Reg No.", "DoB", "Race",
"First Name", "Last Name",
"Reg No.", "DoB", "Race",
"type","Answer")
sample_i %>%
write_csv(paste0(sprintf("./data_output/samples/sample_%02d",i),".csv"))
}
x <- c(3,2,2,5,1,1)
unique(x)
library(dplyr)
library(readr)
library(magrittr)
library(stringr)
is_not_empty <- function(string) {
if(is.na(string) | string == "" | string == ".") {
return(FALSE)
} else {
return(TRUE)
}
}
is_not_empty = Vectorize(is_not_empty)
(source_data <- read_csv("data_input/all.csv",
col_types = cols(.default = "c")))
input_data <-
source_data %>%
mutate_each(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(last_name = str_c(last_name, name_sufx_cd, sep = " ")) %>%
mutate_each(funs(str_trim(.))) %>%
select(ID, voter_reg_num, last_name, first_name, dob, race, type,
everything(), -name_sufx_cd,-src)
input_data
input_data %>%
group_by(ID) %>%
mutate(ID = group_indices())
input_data %>%
mutate(ID = group_indices(ID))
library(dplyr)
library(readr)
library(magrittr)
library(stringr)
input_data %>%
group_by(ID) %>%
mutate(lbl = group_indices()) %>%
View()
input_data %>%
group_by(ID) %>%
mutate(ID = group_indices(input_data, .dots=ID)) %>%
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n != 2) %>%
select(-n) %>%
ungroup()
input_data %>%
group_by(ID) %>%
mutate(lbl = group_indices(input_data, .dots=ID)) %>%
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n != 2) %>%
select(-n) %>%
ungroup()
input_data %>%
group_by(ID) %>%
mutate(lbl = group_indices_(input_data, .dots="ID"))
input_data %>%
mutate(lbl = group_indices_(input_data, .dots="ID"))  %>% View()
View(source_data)
input_data %>%
mutate(lbl = group_indices_(input_data, .dots="ID"))  %>%
group_by() %>%
View()
input_data %>%
select(ID) %>%
unique() %>%
mutate(n = 1:n())
View(input_data)
input_data %>%
left_join(lookup) %>%
mutate(ID = n) %>%
select(-n)
lookup <-
input_data %>%
select(ID) %>%
unique() %>%
mutate(n = 1:n())
input_data %>%
left_join(lookup) %>%
mutate(ID = n) %>%
select(-n)
(source_data <- read_csv("data_input/all.csv",
col_types = cols(.default = "c")))
(input_data <-
source_data %>%
mutate_each(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(last_name = str_c(last_name, name_sufx_cd, sep = " ")) %>%
mutate_each(funs(str_trim(.))) %>%
select(ID, voter_reg_num, last_name, first_name, dob, race, type,
everything(), -name_sufx_cd,-src))
input_data %>%
left_join(lookup) %>%
mutate(ID = n) %>%
select(-n)
input_data <-
input_data %>%
left_join(lookup) %>%
mutate(ID = n) %>%
select(-n)
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n != 2) %>%
select(-n) %>%
ungroup()
input_data <-
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n == 2) %>%
select(-n) %>%
ungroup()
write_csv(input_data, "./data_intermediate/all_no_stars.csv")
View(input_data)
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c")) %>%
mutate_each(funs(ifelse(is_not_empty(.),.,""))))
col_names <- c("Group ID", "Record ID",
"First Name", "FF",
"Last Name", "LF",
"Reg No.", "DoB", "Race",
"First Name", "Last Name",
"Reg No.", "DoB", "Race",
"type","Answer")
starred_data %>%
arrange(ID) %>%
View()
starred_data %>%
arrange(`Group ID`) %>%
View()
starred_data %>%
arrange(as.numeric(`Group ID`)) %>%
View()
starred_data %>%
arrange(as.numeric(`Group ID`)) %>%
View()
names(starred_data) <- col_names
write_csv(starred_data,"all_starred_race.csv")
starred_data <-
starred_data %>%
arrange(as.numeric(`Group ID`))
library(dplyr)
library(readr)
library(magrittr)
library(stringr)
library(forcats)
is_not_empty <- function(string) {
if(is.na(string) | string == "" | string == ".") {
return(FALSE)
} else {
return(TRUE)
}
}
is_not_empty = Vectorize(is_not_empty)
col_names <- c("Group ID", "Record ID",
"First Name", "FF",
"Last Name", "LF",
"Reg No.", "DoB", "Race",
"First Name", "Last Name",
"Reg No.", "DoB", "Race",
"type","Answer")
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c")) %>%
mutate_each(funs(ifelse(is_not_empty(.),.,""))))
starred_data <-
starred_data %>%
arrange(as.numeric(`Group ID`))
(starred_data <-
starred_data %>%
mutate(`Record ID` = str_extract(`Record ID`,"[0-9]+")))
starred_data %>%
select(`Group ID`,type,`Record ID`) %>%
group_by(type,`Record ID`) %>%
unique() %>% count(type,`Record ID`)
set.seed(1)
for(i in 1:10) {
(gids <-
starred_data %>%
group_by(type,`Record ID`) %>%
sample_n(1) %$%
`Group ID`)
(sample_i <-
starred_data %>% filter(`Group ID` %in% gids))
(gids_ordered <-
sample_i %>%
arrange(type) %>%
group_by(type) %>%
do(sample_n(.,size = nrow(.))) %$%
`Group ID` %>%
unique())
(lookup <- tibble(`Group ID` = gids_ordered) %>%
mutate(qnum = 1:n()))
sample_i <-
sample_i %>%
left_join(lookup, by = "Group ID") %>%
mutate(`Group ID` = qnum) %>%
select(-qnum) %>%
arrange(type,`Group ID`)
#make the names standard
names(sample_i) <- col_names
sample_i %>%
write_csv(paste0(sprintf("./data_output/samples/sample_%02d",i),".csv"))
}
names(starred_data) <- col_names
write_csv(starred_data,"all_starred_race.csv")
View(starred_data)
write_csv(starred_data,"./data_output/all_starred_race.csv")
org_names <- c("file_id","voter_reg_num","last_name","first_name","dob","name_sufx_cd","type","ID","src","race","answer")
lookup_2 <-
source_data %>%
select(ID) %>%
unique() %>%
mutate(n = 1:n())
source_data_2 <-
source_data %>%
left_join(lookup_2) %>%
mutate(ID = n) %>%
select(-n)
names(source_data_2) <- org_names
write_csv(source_data_2,"all_groups_changed.csv")
write_csv(source_data_2,"./data_input/all_groups_changed.csv")
source_data_2 <-
source_data %>%
left_join(lookup_2) %>%
mutate(ID = n) %>%
select(-n) %>%
mutate_each(funs(ifelse(is_not_empty(.),.,"")))
names(source_data_2) <- org_names
write_csv(source_data_2,"./data_input/all_groups_changed.csv")
