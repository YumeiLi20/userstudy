depts <- read_csv("C:/Users/gurud/Desktop/new 2.csv", col_names = F)
depts %>%
mutate(depts = str_split())
depts
depts %>%
mutate(depts = str_split(X1, pattern = ">"))
View(depts)
depts %>%
mutate(depts = str(X1, pattern = ">")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4}")) %>%
View
depts
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - [A-Za-z]*<")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - [A-Z a-z]*<")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - ^<")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - $<")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - [A-Z a-z]*<")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} <")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - ?<")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - *<")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - * <")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - ?")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - .*123>?")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - .*123$>?")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - [A-z 0-9 :punct:]*<")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - [A-z 0-9 :punct:]*<"),
four_code = str_extract(X1, pattern = ">[A-Z]{4}) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - [A-z 0-9 :punct:]*<"),
four_code = str_extract(X1, pattern = ">[A-Z]{4}")) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - [A-z 0-9 :punct:]*<"),
four_code = str_extract(X1, pattern = ">[A-Z]{4}"),
four_code = str_sub(2)) %>%
View
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - [A-z 0-9 :punct:]*<"),
four_code = str_extract(X1, pattern = ">[A-Z]{4}"),
four_code = str_sub(four_code,2)) %>%
View
depts <-
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - [A-z 0-9 :punct:]*<"),
four_code = str_extract(X1, pattern = ">[A-Z]{4}"),
four_code = str_sub(four_code,2)) %T>%
View()
library(magrittr)
depts <-
depts %>%
mutate(depts = str_extract(X1, pattern = ">[A-Z]{4} - [A-z 0-9 :punct:]*<"),
four_code = str_extract(X1, pattern = ">[A-Z]{4}"),
four_code = str_sub(four_code,2)) %T>%
View()
depts %>%
write_csv("dept_list.csv")
install.packages("countrycode")
library(countrycode)
countrycode::countrycode_data
countrycode::countrycode()
countrycode <- countrycode_data
countrycode
library(tidyverse)
library(stringr)
library(magrittr)
countrycode %>%
select(country.name.en)
countrycode %$%
select(country.name.en)
countrycode %$%
country.name.en
countries <- countrycode %$%
country.name.en
countries <- c("Please select your country",countries)
tibble(country)
tibble(countries)
tibble(countries) %>%
write_csv("countries.csv")
ans1 %>%
select(-matches("_1")) %>%
mutate(DoB = format(as_date(DoB, format="%m/%d/%Y"), format = "%m/%d/%Y"))
library(tidyverse)
library(lubridate)
library(magrittr)
install.packages("tidyverse")
R.version
version(dplyr)
package_version(dplyr)
package_version("dplyr")
library(tidyverse)
package_version(dplyr)
?packageVersion
packageVersion(dplyr)
packageVersion("dplyr")
install.packages("dplyr")
install.packages("dplyr")
packageVersion(dplyr)
packageVersion("dplyr")
library(readr)
library(dplyr)
library(ggplot2)
name_tbl <- read_csv("./frequencies/nmfreq.csv")
setwd("C:/Users/gurud/Google Drive/Research Assistantship/seq/Gurudev Ilangovan/Record Linkage/userstudy/pipeline")
name_tbl <- read_csv("./frequencies/nmfreq.csv")
(fname_freq <-
name_tbl %>%
count(fname))
name_tbl
(lname_freq <-
name_tbl %>%
count(lname,src))
(fname_freq <-
name_tbl %>%
count(fname,src))
write_csv(fname_freq, "./frequencies/fname_freq.csv")
write_csv(lname_freq, "./frequencies/lname_freq.csv")
(source_data <- read_csv("data_input/all.csv",
col_types = cols(.default = "c")))
View(source_data)
(input_data <-
source_data %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(last_name = str_c(last_name, name_sufx_cd, sep = " ")) %>%
mutate_all(funs(str_trim(.))) %>%
select(ID, voter_reg_num, last_name, first_name, dob, race, type,
everything(), -name_sufx_cd,-src))
org_names <- c("file_id","voter_reg_num","last_name","first_name","dob","name_sufx_cd","type","ID","src","race","answer")
lookup_2 <-
source_data %>%
select(ID) %>%
unique() %>%
mutate(n = 1:n())
source_data_2 <-
source_data %>%
left_join(lookup_2) %>%
mutate(ID = n) %>%
select(-n) %>%
mutate_all(funs(ifelse(is_not_empty(.),.,"")))
library(dplyr)
library(readr)
library(magrittr)
library(stringr)
is_not_empty <- function(string) {
if(is.na(string) | string == "" | string == ".") {
return(FALSE)
} else {
return(TRUE)
}
}
is_not_empty = Vectorize(is_not_empty)
(source_data <- read_csv("data_input/all.csv",
col_types = cols(.default = "c")))
(input_data <-
source_data %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(last_name = str_c(last_name, name_sufx_cd, sep = " ")) %>%
mutate_all(funs(str_trim(.))) %>%
select(ID, voter_reg_num, last_name, first_name, dob, race, type,
everything(), -name_sufx_cd,-src))
org_names <- c("file_id","voter_reg_num","last_name","first_name","dob","name_sufx_cd","type","ID","src","race","answer")
lookup_2 <-
source_data %>%
select(ID) %>%
unique() %>%
mutate(n = 1:n())
source_data_2 <-
source_data %>%
left_join(lookup_2) %>%
mutate(ID = n) %>%
select(-n) %>%
mutate_all(funs(ifelse(is_not_empty(.),.,"")))
names(source_data_2) <- org_names
write_csv(source_data_2,"./data_input/all_groups_changed.csv")
lookup <-
input_data %>%
select(ID) %>%
unique() %>%
mutate(n = 1:n())
input_data <-
input_data %>%
left_join(lookup) %>%
mutate(ID = n) %>%
select(-n)
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n != 2) %>%
select(-n) %>%
ungroup()
input_data <-
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n == 2) %>%
select(-n) %>%
ungroup()
write_csv(input_data, "./data_intermediate/all_no_stars.csv")
View(source_data_2)
(input_data <-
source_data %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(last_name = str_c(last_name, name_sufx_cd, sep = " "),
file_id = str_c(file_id,"-",src)) %>%
mutate_all(funs(str_trim(.))) %>%
select(ID, voter_reg_num, last_name, first_name, dob, race, type,
everything(), -name_sufx_cd,-src))
View(input_data)
(input_data <-
source_data %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(last_name = str_c(last_name, name_sufx_cd, sep = " ")) %>%
mutate_all(funs(str_trim(.))) %>%
select(ID, voter_reg_num, last_name, first_name, dob, race, type,
everything(), -name_sufx_cd,-src))
View(input_data)
(input_data <-
source_data %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(last_name = str_c(last_name, name_sufx_cd, sep = " "),
file_id = str_c(file_id,"-",src)) %>%
mutate_all(funs(str_trim(.))) %>%
select(ID, voter_reg_num, last_name, first_name, dob, race, type,
everything(), -name_sufx_cd,-src))
org_names <- c("file_id","voter_reg_num","last_name","first_name","dob","name_sufx_cd","type","ID","src","race","answer")
lookup_2 <-
source_data %>%
select(ID) %>%
unique() %>%
mutate(n = 1:n())
source_data_2 <-
source_data %>%
left_join(lookup_2) %>%
mutate(ID = n) %>%
select(-n) %>%
mutate_all(funs(ifelse(is_not_empty(.),.,"")))
names(source_data_2) <- org_names
write_csv(source_data_2,"./data_input/all_groups_changed.csv")
lookup <-
input_data %>%
select(ID) %>%
unique() %>%
mutate(n = 1:n())
input_data <-
input_data %>%
left_join(lookup) %>%
mutate(ID = n) %>%
select(-n)
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n != 2) %>%
select(-n) %>%
ungroup()
input_data <-
input_data %>%
group_by(ID) %>%
mutate(n = n()) %>%
filter(n == 2) %>%
select(-n) %>%
ungroup()
write_csv(input_data, "./data_intermediate/all_no_stars.csv")
library(dplyr)
library(readr)
library(magrittr)
library(stringr)
is_not_empty <- function(string) {
if(is.na(string) | string == "" | string == ".") {
return(FALSE)
} else {
return(TRUE)
}
}
is_not_empty = Vectorize(is_not_empty)
col_names <- c("Group ID", "Reg No.",
"FF", "First Name",
"Last Name", "LF",
"DoB", "Race",
"Reg No.", "First Name", "Last Name",
"DoB", "Race",
"Record ID", "type","Same")
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c")) %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))))
(fname_freq <- read_csv("./frequencies/fname_freq.csv") %>%
rename(`First Name` = fname))
(lname_freq <- read_csv("./frequencies/lname_freq.csv") %>%
rename(`Last Name` = lname))
name_tbl <- read_csv("./frequencies/nmfreq.csv") %>%
mutate(src = ifelse(src == 1703, "B", "A"))
(fname_freq <-
name_tbl %>%
count(fname,src))
(lname_freq <-
name_tbl %>%
count(lname,src))
write_csv(fname_freq, "./frequencies/fname_freq.csv")
write_csv(lname_freq, "./frequencies/lname_freq.csv")
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c")) %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))))
View(starred_data)
?strsplit
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c")) %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(src = str_extract(`Record ID`, "[AB]")))
View(starred_data)
(fname_freq <- read_csv("./frequencies/fname_freq.csv") %>%
rename(`First Name` = fname))
(lname_freq <- read_csv("./frequencies/lname_freq.csv") %>%
rename(`Last Name` = lname))
starred_data <-
starred_data %>%
select(`Group ID`, `Reg No.`, FF, `First Name`, `Last Name`, LF,
DoB, Race, `Reg No._1`, `First Name_1`, `Last Name_1`, DoB_1, Race_1,
`Record ID`, type, Same) %>%
arrange(as.numeric(`Group ID`))
starred_data <-
starred_data %>%
left_join(fname_freq) %>%
mutate(FF = ifelse(!is.na(n),n,1)) %>%
select(-n)
starred_data <-
starred_data %>%
left_join(lname_freq, by(`First Name`, src)) %>%
mutate(LF = ifelse(!is.na(n),n,1)) %>%
select(-n)
starred_data <-
starred_data %>%
left_join(lname_freq, by("First Name", "src")) %>%
mutate(LF = ifelse(!is.na(n),n,1)) %>%
select(-n)
starred_data %>%
left_join(lname_freq, by("First Name", "src"))
starred_data <-
starred_data %>%
left_join(lname_freq, by("`First Name`", "src")) %>%
mutate(LF = ifelse(!is.na(n),n,1)) %>%
select(-n)
(fname_freq <- read_csv("./frequencies/fname_freq.csv"))
(lname_freq <- read_csv("./frequencies/lname_freq.csv"))
starred_data <-
starred_data %>%
select(`Group ID`, `Reg No.`, FF, fname = `First Name`, lname = `Last Name`, LF,
DoB, Race, `Reg No._1`, `First Name_1`, `Last Name_1`, DoB_1, Race_1,
`Record ID`, type, Same) %>%
arrange(as.numeric(`Group ID`))
starred_data <-
starred_data %>%
left_join(fname_freq) %>%
mutate(FF = ifelse(!is.na(n),n,1)) %>%
select(-n)
starred_data <-
starred_data %>%
left_join(fname_freq, by = c("fname","src")) %>%
mutate(FF = ifelse(!is.na(n),n,1)) %>%
select(-n)
View(starred_data)
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c")) %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(src = str_extract(`Record ID`, "[AB]")))
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c", `Group ID` = "i")) %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(src = str_extract(`Record ID`, "[AB]")))
View(starred_data)
(fname_freq <- read_csv("./frequencies/fname_freq.csv"))
(lname_freq <- read_csv("./frequencies/lname_freq.csv"))
starred_data <-
starred_data %>%
select(`Group ID`, `Reg No.`, FF, fname = `First Name`, lname = `Last Name`, LF,
DoB, Race, `Reg No._1`, `First Name_1`, `Last Name_1`, DoB_1, Race_1,
`Record ID`, type, Same) %>%
arrange(as.numeric(`Group ID`))
starred_data %>%
left_join(fname_freq, by = c("fname","src")) %>%
mutate(FF = ifelse(!is.na(n),n,1)) %>%
select(-n) %>%
View()
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c", `Group ID` = "i")) %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(src = str_extract(`Record ID`, "[AB]")))
(fname_freq <- read_csv("./frequencies/fname_freq.csv"))
(lname_freq <- read_csv("./frequencies/lname_freq.csv"))
starred_data <-
starred_data %>%
left_join(fname_freq, by = c("fname","src")) %>%
mutate(FF = ifelse(!is.na(n),n,1)) %>%
select(-n) %>%
View()
(starred_data <- read_csv("./data_output/all_starred_race.csv", col_types = cols(.default = "c", `Group ID` = "i")) %>%
mutate_all(funs(ifelse(is_not_empty(.),.,""))) %>%
mutate(src = str_extract(`Record ID`, "[AB]")) %>%
rename(fname = `First Name`,
lname = `Last Name`))
(fname_freq <- read_csv("./frequencies/fname_freq.csv"))
(lname_freq <- read_csv("./frequencies/lname_freq.csv"))
starred_data %>%
left_join(fname_freq, by = c("fname","src")) %>%
mutate(FF = ifelse(!is.na(n),n,1)) %>%
select(-n) %>%
View()
starred_data <-
starred_data %>%
left_join(lname_freq, by("lname","src")) %>%
mutate(LF = ifelse(!is.na(n),n,1)) %>%
select(-n)
(lname_freq <- read_csv("./frequencies/lname_freq.csv"))
View(starred_data)
starred_data <-
starred_data %>%
left_join(lname_freq, by = c("lname","src")) %>%
mutate(LF = ifelse(!is.na(n),n,1)) %>%
select(-n)
View(fname_freq)
fname_freq
View(fname_freq)
(fname_freq <- read_csv("./frequencies/fname_freq.csv"))
(lname_freq <- read_csv("./frequencies/lname_freq.csv"))
View(fname_freq)
View(starred_data)
starred_data <-
starred_data %>%
left_join(fname_freq, by = c("fname","src")) %>%
mutate(FF = ifelse(!is.na(n),n,1)) %>%
select(-n)
starred_data <-
starred_data %>%
left_join(lname_freq, by = c("lname","src")) %>%
mutate(LF = ifelse(!is.na(n),n,1)) %>%
select(-n)
(starred_data <-
starred_data %>%
mutate(`Record ID` = str_extract(`Record ID`,"[0-9]+")))
starred_data <-
starred_data %>%
select(`Group ID`, `Reg No.`, FF, fname, lname, LF,
DoB, Race, `Reg No._1`, `First Name_1`, `Last Name_1`, DoB_1, Race_1,
`Record ID`, type, Same) %>%
arrange(as.numeric(`Group ID`))
starred_data %>%
select(`Group ID`,type,`Record ID`) %>%
group_by(type,`Record ID`) %>%
unique() %>% count(type,`Record ID`)
set.seed(1)
for(i in 1:10) {
(gids <-
starred_data %>%
group_by(type,`Record ID`) %>%
sample_n(1) %$%
`Group ID`)
(sample_i <-
starred_data %>% filter(`Group ID` %in% gids))
(gids_ordered <-
sample_i %>%
arrange(type) %>%
group_by(type) %>%
do(sample_n(.,size = nrow(.))) %$%
`Group ID` %>%
unique())
(lookup <- tibble(`Group ID` = gids_ordered) %>%
mutate(qnum = 1:n()))
sample_i <-
sample_i %>%
left_join(lookup, by = "Group ID") %>%
mutate(`Group ID` = qnum) %>%
select(-qnum) %>%
arrange(type,`Group ID`)
#make the names standard
names(sample_i) <- col_names
sample_i %>%
write_csv(paste0(sprintf("./data_output/samples/sample_%02d",i),".csv"))
}
names(starred_data) <- col_names
write_csv(starred_data,"./data_output/all_starred_race.csv")
library(readr)
library(dplyr)
library(ggplot2)
name_tbl <- read_csv("./nmfreq.csv") %>%
mutate(src = ifelse(src == 1703, "B", "A"))
